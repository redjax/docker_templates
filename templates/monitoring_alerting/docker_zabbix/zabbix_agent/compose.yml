---
name: zabbix-agent

services:
  zabbix-agent2:
    image: zabbix/zabbix-agent2:${ZABBIX_VERSION:-latest}
    container_name: zabbix-agent2
    restart: unless-stopped
    privileged: true
    environment:
      # Server for passive checks (mandatory)
      ZBX_SERVER_HOST: ${ZABBIX_AGENT_SERVER_HOST:-zabbix-server}

      # Server for active checks (mandatory)
      ZBX_SERVER_ACTIVE: ${ZABBIX_AGENT_SERVER_HOST:-zabbix-server}:${ZABBIX_AGENT_SERVER_PORT:-10051}

      # Hostname: use override if provided, otherwise detect host automatically
      ZBX_HOSTNAME: ${ZABBIX_AGENT_HOSTNAME_OVERRIDE:-}
      ZBX_HOSTNAMEITEM: system.hostname

      # Metadata for auto-registration
      ZBX_METADATA: ${ZABBIX_AGENT_METADATA_OVERRIDE:-docker-host}

      # Debug level (0-5)
      ZBX_DEBUGLEVEL: ${ZABBIX_AGENT_DEBUGLEVEL:-3}

      # Optional registration key for auto-registration
      ZBX_REGISTRATION_KEY: ${ZABBIX_REGISTRATION_KEY:-}

    volumes:
      - /:/hostfs:ro
      - /var/run/docker.sock:/var/run/docker.sock
